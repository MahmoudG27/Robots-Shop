global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'robot-shop-local'
    environment: 'development'

# Alertmanager configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets: []
          # - 'alertmanager:9093'

# Load rules once and periodically evaluate them
rule_files:
  - 'alerts.yml'

scrape_configs:
  # ==================== PROMETHEUS ====================
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # ==================== CATALOGUE SERVICE ====================
  - job_name: 'catalogue'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['catalogue:8080']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - source_labels: [__scheme__]
        target_label: scheme
      - target_label: service
        replacement: 'catalogue'

  # ==================== CART SERVICE ====================
  - job_name: 'cart'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['cart:8080']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - target_label: service
        replacement: 'cart'

  # ==================== USER SERVICE ====================
  - job_name: 'user'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['user:8080']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - target_label: service
        replacement: 'user'

  # ==================== PAYMENT SERVICE ====================
  - job_name: 'payment'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['payment:8080']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - target_label: service
        replacement: 'payment'

  # ==================== DISPATCH SERVICE ====================
  - job_name: 'dispatch'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['dispatch:9090']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - target_label: service
        replacement: 'dispatch'

  # ==================== SHIPPING SERVICE (JAVA) ====================
  - job_name: 'shipping'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/actuator/prometheus'
    static_configs:
      - targets: ['shipping:8080']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
      - target_label: service
        replacement: 'shipping'

  # ==================== MONGODB ====================
  - job_name: 'mongodb'
    scrape_interval: 30s
    scrape_timeout: 10s
    static_configs:
      - targets: ['mongo:27017']

  # ==================== MYSQL ====================
  - job_name: 'mysql'
    scrape_interval: 30s
    scrape_timeout: 10s
    static_configs:
      - targets: ['mysql:3306']

  # ==================== REDIS ====================
  - job_name: 'redis'
    scrape_interval: 30s
    scrape_timeout: 10s
    static_configs:
      - targets: ['redis:6379']

  # ==================== RABBITMQ ====================
  - job_name: 'rabbitmq'
    scrape_interval: 30s
    scrape_timeout: 10s
    static_configs:
      - targets: ['rabbitmq:5672']

  # ==================== RABBITMQ MANAGEMENT ====================
  - job_name: 'rabbitmq-management'
    scrape_interval: 30s
    scrape_timeout: 10s
    metrics_path: '/api/metrics'
    basic_auth:
      username: 'guest'
      password: 'guest'
    scheme: 'http'
    static_configs:
      - targets: ['rabbitmq:15672']